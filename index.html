<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C Pearl White | Cosmetics</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBGoeRwb6VlEknQKaLSOSY2tyBUeLJzEI4",
  authDomain: "c-pearl-white.firebaseapp.com",
  databaseURL: "https://c-pearl-white-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "c-pearl-white",
  storageBucket: "c-pearl-white.firebasestorage.app",
  messagingSenderId: "647160306453",
  appId: "1:647160306453:web:646b71814ff5534560671c"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Expose to global scope for main script
window._fbSet = (path, data) => set(ref(db, path), data);
window._fbGet = (path) => get(ref(db, path)).then(snap => snap.exists() ? snap.val() : null);
window._fbReady = true;
window.dispatchEvent(new Event('fbready'));
</script>
<style>
:root {
  --rose:#c8526b; --blush:#f2d4d9; --cream:#fdf6f0;
  --gold:#c9a96e; --dark:#2a1a1f; --muted:#8a6d73;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--dark);overflow-x:hidden;}

/* ====== NAV ====== */
nav{
  position:fixed;top:0;left:0;right:0;z-index:100;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 1.5rem;height:60px;
  background:rgba(42,26,31,0.95);backdrop-filter:blur(10px);
}
.nav-brand{display:flex;align-items:center;gap:0.7rem;flex-shrink:0;}
.nav-logo-img{height:36px;width:auto;object-fit:contain;border-radius:50%;border:1px solid var(--gold);}
.nav-logo-text{font-family:'Playfair Display',serif;color:var(--gold);font-size:1.1rem;white-space:nowrap;}
.nav-logo-text span{color:#fff;font-style:italic;}

/* Center nav tabs */
.nav-center{display:flex;gap:0;}
.nav-tab{
  color:rgba(255,255,255,0.7);text-decoration:none;
  padding:0 1.2rem;height:60px;display:flex;align-items:center;
  font-size:0.85rem;letter-spacing:0.08em;text-transform:uppercase;
  border-bottom:2px solid transparent;transition:all 0.2s;white-space:nowrap;
}
.nav-tab:hover,.nav-tab.active{color:#fff;border-bottom-color:var(--rose);}

.nav-wa{
  background:#25D366;color:#fff;padding:0.45rem 1rem;
  text-decoration:none;font-size:0.8rem;font-weight:500;
  border-radius:2px;white-space:nowrap;flex-shrink:0;
}

/* ====== HERO ====== */
header{
  min-height:100vh;
  background:linear-gradient(135deg,#2a1a1f 0%,#4a2535 50%,#2a1a1f 100%);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  position:relative;overflow:hidden;padding:2rem;text-align:center;
}
header::before{
  content:'';position:absolute;width:600px;height:600px;
  background:radial-gradient(circle,rgba(200,82,107,0.25) 0%,transparent 70%);
  top:50%;left:50%;transform:translate(-50%,-50%);
  animation:pulse 4s ease-in-out infinite;
}
header::after{content:'‚ú¶ ‚ú¶ ‚ú¶';position:absolute;bottom:2rem;color:var(--gold);font-size:0.8rem;letter-spacing:1rem;opacity:0.6;}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:.7}50%{transform:translate(-50%,-50%) scale(1.2);opacity:1}}
.hero-name{font-family:'Playfair Display',serif;font-size:clamp(3rem,10vw,6rem);color:var(--gold);line-height:1.1;position:relative;z-index:1;animation:fadeUp 1s ease forwards;}
.hero-name span{color:#fff;font-style:italic;}
.hero-tagline{color:var(--blush);font-size:0.9rem;letter-spacing:.4em;text-transform:uppercase;margin-top:1.2rem;position:relative;z-index:1;animation:fadeUp 1s .2s ease both;}
.hero-btn{margin-top:2.5rem;padding:1rem 2.5rem;background:var(--rose);color:#fff;border:none;font-family:'DM Sans',sans-serif;font-size:.95rem;letter-spacing:.15em;text-transform:uppercase;cursor:pointer;text-decoration:none;display:inline-block;position:relative;z-index:1;animation:fadeUp 1s .4s ease both;transition:background .3s,transform .2s;}
.hero-btn:hover{background:var(--gold);transform:translateY(-2px);}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* ====== SECTION COMMONS ====== */
.section-label{font-size:.75rem;letter-spacing:.4em;text-transform:uppercase;color:var(--rose);margin-bottom:.8rem;}
.section-title{font-family:'Playfair Display',serif;font-size:clamp(2rem,5vw,3rem);line-height:1.2;margin-bottom:1rem;}
.section-title em{color:var(--rose);font-style:italic;}

/* ====== COLLECTION / PRODUCTS ====== */
.products{background:#fff;padding:5rem 1.5rem;}
.products-inner{max-width:1100px;margin:0 auto;}
.products-header{text-align:center;margin-bottom:2rem;}

/* Category filter tabs */
.cat-tabs{display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin-bottom:2.5rem;}
.cat-tab{
  padding:.45rem 1.2rem;border:1px solid var(--blush);background:transparent;
  color:var(--muted);font-family:'DM Sans',sans-serif;font-size:.82rem;
  letter-spacing:.06em;text-transform:uppercase;cursor:pointer;transition:all .2s;border-radius:2px;
}
.cat-tab:hover{border-color:var(--rose);color:var(--rose);}
.cat-tab.active{background:var(--rose);border-color:var(--rose);color:#fff;}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:2rem;}

.card{background:var(--cream);border:1px solid var(--blush);overflow:hidden;transition:transform .3s,box-shadow .3s;position:relative;}
.card:hover{transform:translateY(-6px);box-shadow:0 20px 40px rgba(200,82,107,.15);}
.card.in-cart{border-color:var(--rose);box-shadow:0 0 0 2px rgba(200,82,107,.2);}
.card.out-of-stock{opacity:.6;}
.card.hidden-card{display:none;}

.card-img{height:200px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--blush),#f8e8ec);font-size:4rem;position:relative;overflow:hidden;}
.card-img img{width:100%;height:100%;object-fit:cover;}
.card-badge{position:absolute;top:1rem;right:1rem;background:var(--rose);color:#fff;font-size:.7rem;padding:.25rem .6rem;letter-spacing:.1em;text-transform:uppercase;z-index:2;}
.stock-badge{position:absolute;top:1rem;left:1rem;font-size:.7rem;padding:.25rem .7rem;letter-spacing:.08em;text-transform:uppercase;font-weight:600;z-index:2;}
.stock-badge.available{background:#25D366;color:#fff;}
.stock-badge.out{background:#666;color:#fff;}
.free-delivery-tag{position:absolute;bottom:0;left:0;right:0;background:var(--gold);color:#fff;font-size:.7rem;text-align:center;padding:.2rem;letter-spacing:.08em;text-transform:uppercase;}
.cat-label-tag{position:absolute;bottom:0;left:0;right:0;background:rgba(42,26,31,.6);color:var(--blush);font-size:.68rem;text-align:center;padding:.18rem;letter-spacing:.06em;text-transform:uppercase;}
.card-body{padding:1.5rem;}
.card-name{font-family:'Playfair Display',serif;font-size:1.15rem;margin-bottom:.4rem;}
.card-desc{font-size:.85rem;color:var(--muted);margin-bottom:1rem;line-height:1.5;}
.card-footer{display:flex;align-items:center;justify-content:space-between;}
.price{font-size:1.2rem;font-weight:700;color:var(--rose);}
.price small{font-size:.75rem;color:var(--muted);font-weight:400;}
.qty-ctrl{display:flex;align-items:center;gap:.6rem;}
.qty-btn{width:32px;height:32px;background:var(--rose);color:#fff;border:none;font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;border-radius:2px;}
.qty-btn:hover{background:var(--dark);}
.qty-btn:disabled{background:#ccc;cursor:not-allowed;}
.qty-val{font-size:1.1rem;font-weight:700;min-width:24px;text-align:center;}

/* Cart bar */
.cart-bar{display:none;position:sticky;bottom:1rem;margin-top:2.5rem;background:var(--dark);color:#fff;padding:1rem 1.5rem;border-left:4px solid var(--rose);align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap;box-shadow:0 8px 30px rgba(0,0,0,.3);z-index:50;animation:slideUp .3s ease;}
.cart-bar.visible{display:flex;}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.cart-info{font-size:.9rem;color:var(--blush);}
.cart-total{font-size:1.1rem;}
.cart-total strong{color:var(--gold);}
.cart-checkout{background:var(--rose);color:#fff;padding:.6rem 1.4rem;text-decoration:none;font-size:.85rem;letter-spacing:.1em;text-transform:uppercase;transition:background .2s;white-space:nowrap;}
.cart-checkout:hover{background:var(--gold);}

/* ====== WHY ====== */
.why{background:var(--cream);padding:5rem 1.5rem;}
.why-inner{max-width:900px;margin:0 auto;text-align:center;}
.features{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:2rem;margin-top:3rem;}
.feature{padding:2rem 1.5rem;background:#fff;border-top:3px solid var(--rose);}
.feature-icon{font-size:2rem;margin-bottom:1rem;}
.feature-title{font-family:'Playfair Display',serif;font-size:1.1rem;margin-bottom:.5rem;}
.feature-text{font-size:.85rem;color:var(--muted);line-height:1.6;}

/* ====== ORDER ====== */
.order-section{background:var(--dark);color:#fff;padding:5rem 1.5rem;}
.order-inner{max-width:600px;margin:0 auto;text-align:center;}
.order-inner .section-title{color:#fff;}
.order-inner .section-label{color:var(--gold);}
.form-group{margin-bottom:1.2rem;text-align:left;}
.form-group label{display:block;font-size:.8rem;letter-spacing:.1em;text-transform:uppercase;color:var(--blush);margin-bottom:.4rem;}
.form-group input,.form-group textarea{width:100%;padding:.9rem 1rem;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.2);color:#fff;font-family:'DM Sans',sans-serif;font-size:.95rem;outline:none;transition:border-color .2s;}
.form-group input:focus,.form-group textarea:focus{border-color:var(--rose);}
.form-group input.error{border-color:#ff6b6b;}
.field-error{color:#ff6b6b;font-size:.75rem;margin-top:.3rem;display:none;}
.optional-tag{font-size:.7rem;color:var(--muted);margin-left:.4rem;text-transform:none;letter-spacing:0;}
.form-group textarea{min-height:80px;resize:vertical;}
.form-row{display:flex;gap:1rem;}
.form-row .form-group{flex:1;}
.summary-box{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.2);padding:1rem;min-height:80px;text-align:left;}
.summary-row{font-size:.85rem;color:var(--blush);padding:.3rem 0;display:flex;justify-content:space-between;}
.summary-divider{border:none;border-top:1px solid rgba(255,255,255,.12);margin:.6rem 0;}
.summary-delivery{font-size:.85rem;color:#aaa;padding:.3rem 0;display:flex;justify-content:space-between;}
.summary-total-row{display:flex;justify-content:space-between;font-weight:700;color:var(--gold);font-size:1.05rem;padding-top:.3rem;}
.submit-btn{width:100%;padding:1.1rem;background:var(--rose);color:#fff;border:none;font-family:'DM Sans',sans-serif;font-size:1rem;letter-spacing:.15em;text-transform:uppercase;cursor:pointer;margin-top:.8rem;transition:background .2s,transform .2s;}
.submit-btn:hover{background:var(--gold);transform:translateY(-2px);}
.success-msg{display:none;background:rgba(37,211,102,.15);border:1px solid #25D366;padding:1rem;color:#25D366;margin-top:1rem;font-size:.9rem;}

/* ====== FOOTER ====== */
footer{background:#1a0f13;color:var(--muted);text-align:center;padding:2rem;font-size:.85rem;}
.foot-brand{font-family:'Playfair Display',serif;color:#fff;font-size:1.4rem;margin-bottom:.5rem;}
.foot-brand span{color:var(--gold);font-style:italic;}
.wa-float{position:fixed;bottom:2rem;right:2rem;width:58px;height:58px;background:#25D366;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.6rem;text-decoration:none;box-shadow:0 4px 20px rgba(37,211,102,.4);z-index:200;animation:bounce 2s ease-in-out infinite;}
.wa-float:hover{transform:scale(1.1);}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

/* ====== ADMIN ====== */
#adminBtn{display:none;}
.admin-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:10000;align-items:center;justify-content:center;padding:1rem;}
.admin-overlay.open{display:flex;}
.admin-panel{background:#1e1018;border:1px solid var(--gold);width:100%;max-width:750px;max-height:92vh;overflow-y:auto;padding:2rem;position:relative;}
.admin-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--muted);font-size:1.4rem;cursor:pointer;}
.admin-title{font-family:'Playfair Display',serif;color:var(--gold);font-size:1.4rem;margin-bottom:1.5rem;}
.admin-section{margin-bottom:2rem;}
.admin-section-title{font-size:.75rem;letter-spacing:.3em;text-transform:uppercase;color:var(--rose);margin-bottom:1rem;padding-bottom:.4rem;border-bottom:1px solid rgba(255,255,255,.1);}
.admin-row{display:flex;gap:1rem;flex-wrap:wrap;margin-bottom:.8rem;}
.admin-field{flex:1;min-width:140px;}
.admin-field label{display:block;font-size:.75rem;color:var(--blush);margin-bottom:.3rem;letter-spacing:.05em;}
.admin-field input,.admin-field select,.admin-field textarea{width:100%;padding:.6rem .8rem;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);color:#fff;font-family:'DM Sans',sans-serif;font-size:.9rem;outline:none;}
.admin-field input:focus,.admin-field select:focus{border-color:var(--rose);}
.admin-field select option{background:#1e1018;}
.admin-field input[type=checkbox]{width:auto;margin-right:.4rem;}
.logo-preview-box{width:80px;height:80px;border:1px dashed var(--muted);display:flex;align-items:center;justify-content:center;font-size:.7rem;color:var(--muted);overflow:hidden;flex-shrink:0;}
.logo-preview-box img{width:100%;height:100%;object-fit:contain;}
.product-admin-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);padding:1rem;margin-bottom:1rem;}
.product-admin-card-title{font-size:.85rem;color:var(--blush);margin-bottom:.8rem;}
.img-preview-admin{width:60px;height:60px;border:1px dashed var(--muted);display:flex;align-items:center;justify-content:center;font-size:1.8rem;overflow:hidden;flex-shrink:0;}
.img-preview-admin img{width:100%;height:100%;object-fit:cover;}
.admin-save-btn{width:100%;padding:.9rem;background:var(--rose);color:#fff;border:none;font-family:'DM Sans',sans-serif;font-size:.95rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:background .2s;margin-top:.5rem;}
.admin-save-btn:hover{background:var(--gold);}
.add-product-btn{width:100%;padding:.7rem;background:transparent;border:1px dashed var(--gold);color:var(--gold);font-family:'DM Sans',sans-serif;font-size:.85rem;cursor:pointer;margin-bottom:1rem;letter-spacing:.08em;text-transform:uppercase;transition:background .2s;}
.add-product-btn:hover{background:rgba(201,169,110,.1);}
.del-product-btn{background:#6b2a2a;color:#fff;border:none;padding:.3rem .7rem;font-size:.75rem;cursor:pointer;border-radius:2px;flex-shrink:0;}

.sp-banner{background:linear-gradient(135deg,#2a1a1f,#4a2535);color:#fff;text-align:center;padding:.5rem 1rem;font-size:.8rem;letter-spacing:.05em;position:fixed;top:60px;left:0;right:0;z-index:99;display:none;}
.sp-banner.show{display:block;}
.sp-banner strong{color:var(--gold);}
.sp-card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);padding:1rem;margin-bottom:.8rem;border-radius:2px;}
.sp-stats{display:inline-block;background:rgba(201,169,110,.15);color:var(--gold);border:1px solid var(--gold);font-size:.75rem;padding:.2rem .6rem;border-radius:2px;margin-top:.3rem;}
.sp-link-box{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);padding:.5rem .8rem;font-size:.75rem;color:var(--blush);word-break:break-all;margin-top:.4rem;cursor:pointer;position:relative;}
.sp-link-box:hover{border-color:var(--gold);}
.copy-hint{position:absolute;right:.5rem;top:50%;transform:translateY(-50%);font-size:.7rem;color:var(--gold);}
@media(max-width:700px){
  .nav-center{display:none;}
  .nav-logo-text{font-size:.95rem;}
  .form-row{flex-direction:column;gap:0;}
  .grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<!-- ADMIN BUTTON (hidden) -->
<button id="adminBtn" onclick="askAdminPassword()">‚öô Admin</button>

<!-- PASSWORD MODAL -->
<div class="admin-overlay" id="pwOverlay">
  <div class="admin-panel" style="max-width:360px;padding:2rem;">
    <div class="admin-title" style="font-size:1.1rem;margin-bottom:1.2rem;">üîê Admin Login</div>
    <div class="admin-field" style="margin-bottom:1rem;">
      <label>Password</label>
      <input type="password" id="adminPwInput" placeholder="Enter password..." onkeydown="if(event.key==='Enter')checkAdminPw()">
    </div>
    <div id="pwError" style="color:#ff6b6b;font-size:.8rem;margin-bottom:.8rem;display:none;">‚ùå Wrong password!</div>
    <button class="admin-save-btn" onclick="checkAdminPw()">Login</button>
    <button onclick="document.getElementById('pwOverlay').classList.remove('open')" style="width:100%;padding:.7rem;background:transparent;border:1px solid rgba(255,255,255,.2);color:var(--muted);margin-top:.6rem;cursor:pointer;font-family:'DM Sans',sans-serif;">Cancel</button>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-overlay" id="adminOverlay">
  <div class="admin-panel">
    <button class="admin-close" onclick="document.getElementById('adminOverlay').classList.remove('open')">‚úï</button>
    <div class="admin-title">‚öô Store Settings</div>

    <!-- BRANDING -->
    <div class="admin-section">
      <div class="admin-section-title">Store Branding</div>
      <div class="admin-row">
        <div class="admin-field"><label>Store Name Line 1</label><input type="text" id="aStoreName1" value="C Pearl"></div>
        <div class="admin-field"><label>Store Name Line 2 (Italic)</label><input type="text" id="aStoreName2" value="White"></div>
      </div>
      <div class="admin-row">
        <div class="admin-field"><label>Tagline</label><input type="text" id="aTagline" value="‚ú¶ Premium Cosmetics ‚ú¶ Sri Lanka ‚ú¶"></div>
      </div>
      <div class="admin-row" style="align-items:flex-end;gap:1.5rem;margin-top:.5rem;">
        <div class="admin-field"><label>Logo Image (Upload)</label><input type="file" id="aLogoFile" accept="image/*" onchange="previewLogo(this)"></div>
        <div><div style="font-size:.7rem;color:var(--muted);margin-bottom:.4rem;">Preview</div><div class="logo-preview-box" id="logoPreviewBox">No logo</div></div>
      </div>
      <div class="admin-row">
        <div class="admin-field">
          <label>Display Mode</label>
          <select id="aLogoMode">
            <option value="name">Name Only</option>
            <option value="logo">Logo Only</option>
            <option value="both">Both (Logo + Name)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- CATEGORIES -->
    <div class="admin-section">
      <div class="admin-section-title">Categories</div>
      <div id="catAdminList"></div>
      <button class="add-product-btn" onclick="addCategory()">+ Add Category</button>
    </div>

    <!-- DELIVERY -->
    <div class="admin-section">
      <div class="admin-section-title">Delivery Charges</div>
      <div class="admin-row">
        <div class="admin-field"><label>Standard Delivery (Rs.)</label><input type="number" id="aDeliveryCharge" value="350" min="0"></div>
        <div class="admin-field"><label>Free Delivery Above (Rs.) ‚Äî 0=disabled</label><input type="number" id="aFreeDeliveryAbove" value="0" min="0"></div>
      </div>
    </div>

    <!-- SALES PERSONS -->
    <div class="admin-section">
      <div class="admin-section-title">üë• Sales Persons</div>
      <p style="font-size:.78rem;color:var(--muted);margin-bottom:1rem;">‡∑Ñ‡∑ê‡∂∏ Sales Person ‡∂ß unique link ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ω‡∑ê‡∂∂‡∑ô‡∂±‡∑Ä‡∑è. Customer ‡∂í link open ‡∂ö‡∑Ö‡∑è‡∂∏ order ‡∂î‡∑Ä‡∑î‡∂±‡∑ä‡∂ú‡∑ö WhatsApp number ‡∂ß ‡∂∫‡∂±‡∑Ä‡∑è.</p>
      <div id="spAdminList"></div>
      <button class="add-product-btn" onclick="addSalesPerson()">+ Add Sales Person</button>
    </div>

    <!-- PRODUCTS -->
    <div class="admin-section">
      <div class="admin-section-title">Products</div>
      <div id="productAdminList"></div>
      <button class="add-product-btn" onclick="addProduct()">+ Add New Product</button>
    </div>

    <button class="admin-save-btn" onclick="saveAdmin()">üíæ Save & Apply</button>
  </div>
</div>

<!-- NAV -->
<nav>
  <div class="nav-brand">
    <img class="nav-logo-img" id="navLogoImg" src="" alt="">
    <div class="nav-logo-text" id="navLogoText">C Pearl <span>White</span></div>
  </div>
  <div class="nav-center" id="navCenter">
    <a href="#" class="nav-tab active" onclick="showCategory('all',this)">All</a>
    <!-- dynamic category tabs injected here -->
  </div>
  <a href="https://wa.me/94728626128" target="_blank" class="nav-wa">üí¨ WhatsApp</a>
</nav>

<!-- SALESPERSON BANNER -->
<div class="sp-banner" id="spBanner">
  Ordering via: <strong id="spBannerName"></strong>
</div>

<!-- HERO -->
<header>
  <img class="hero-logo-img" id="heroLogoImg" src="" alt="">
  <div class="hero-name" id="heroName">C Pearl<br><span>White</span></div>
  <p class="hero-tagline" id="heroTagline">‚ú¶ Premium Cosmetics ‚ú¶ Sri Lanka ‚ú¶</p>
  <a href="#products" class="hero-btn">Shop Now</a>
</header>

<!-- PRODUCTS -->
<section class="products" id="products">
  <div class="products-inner">
    <div class="products-header">
      <p class="section-label">Our Collection</p>
      <h2 class="section-title">Discover <em>Beauty</em></h2>
      <p style="color:var(--muted);max-width:500px;margin:0 auto;font-size:.9rem;">Sri Lanka ‡∂¥‡∑î‡∂ª‡∑è delivery ‡∑É‡∂∏‡∂ü premium cosmetics collection</p>
    </div>
    <!-- Category filter tabs (mobile / section level) -->
    <div class="cat-tabs" id="catTabsSection"></div>
    <div class="grid" id="productGrid"></div>
    <div class="cart-bar" id="cartBar">
      <div class="cart-info">üõí <span id="cartCount">0</span> items</div>
      <div class="cart-total">Subtotal: <strong>Rs. <span id="cartSubtotal">0</span></strong></div>
      <a href="#order" class="cart-checkout">Checkout ‚Üí</a>
    </div>
  </div>
</section>

<!-- WHY -->
<section class="why">
  <div class="why-inner">
    <p class="section-label">Why Choose Us</p>
    <h2 class="section-title">C Pearl White<em>Promise</em></h2>
    <div class="features">
      <div class="feature"><div class="feature-icon">üöö</div><div class="feature-title">Island-wide Delivery</div><div class="feature-text">Sri Lanka ‡∂¥‡∑î‡∂ª‡∑è delivery. 2-3 working days.</div></div>
      <div class="feature"><div class="feature-icon">üíé</div><div class="feature-title">Premium Quality</div><div class="feature-text">100% authentic products. Quality guaranteed.</div></div>
      <div class="feature"><div class="feature-icon">üí¨</div><div class="feature-title">Fast Response</div><div class="feature-text">WhatsApp reply within minutes. Customer first.</div></div>
    </div>
  </div>
</section>

<!-- ORDER FORM -->
<section class="order-section" id="order">
  <div class="order-inner">
    <p class="section-label">Place Your Order</p>
    <h2 class="section-title">Order <em style="color:var(--gold)">Now</em></h2>
    <p style="color:var(--muted);margin-bottom:2.5rem;font-size:.9rem;">Form fill ‡∂ö‡∂ª‡∂±‡∑ä‡∂±, WhatsApp via confirm ‡∂ö‡∂ª‡∂±‡∑ä‡∂±‡∂∏‡∑ä</p>
    <form id="orderForm" novalidate>

      <div class="form-group">
        <label>‡∂î‡∂∂‡∑ö ‡∂±‡∂∏ (Your Name)</label>
        <input type="text" id="custName" placeholder="Full Name" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Contact No 1</label>
          <input type="tel" id="custPhone1" placeholder="07X XXXXXXX" maxlength="10" required>
          <div class="field-error" id="errPhone1">Please enter a valid 10-digit number.</div>
        </div>
        <div class="form-group">
          <label>Contact No 2 <span class="optional-tag">(Optional)</span></label>
          <input type="tel" id="custPhone2" placeholder="07X XXXXXXX" maxlength="10">
          <div class="field-error" id="errPhone2">Please enter a valid 10-digit number.</div>
        </div>
      </div>

      <div class="form-group">
        <label>Delivery Address</label>
        <input type="text" id="custAddress" placeholder="No, Street, Village" required>
      </div>

      <div class="form-group">
        <label>Near City / Town</label>
        <input type="text" id="custCity" placeholder="Nearest city or town" required>
      </div>

      <div class="form-group">
        <label>Order Summary</label>
        <div class="summary-box" id="summaryBox">
          <p id="noItemsMsg" style="color:var(--muted);font-size:.85rem;">‚¨ÜÔ∏è Products select ‡∂ö‡∂ª‡∂±‡∑ä‡∂± above</p>
          <div id="summaryItems"></div>
          <div id="summaryFooter" style="display:none">
            <hr class="summary-divider">
            <div class="summary-delivery"><span id="deliveryLabel">Delivery</span><span id="deliveryValue">Rs. 0</span></div>
            <hr class="summary-divider">
            <div class="summary-total-row"><span>Total</span><span>Rs. <span id="formTotal">0</span></span></div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Notes / Special Request</label>
        <textarea id="custNote" placeholder="Shade, quantity, or any special request..."></textarea>
      </div>

      <button type="submit" class="submit-btn">Send Order via WhatsApp üí¨</button>
      <div class="success-msg" id="successMsg">‚úÖ WhatsApp opening... Order confirm ‡∑Ä‡∑ô‡∂±‡∑Ä‡∑è!</div>
    </form>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="foot-brand" id="footBrand">C Pearl <span>White</span></div>
  <p>Premium Cosmetics ¬∑ Sri Lanka</p>
  <p style="margin-top:.5rem">üì± <a href="https://wa.me/94728626128" style="color:var(--gold);text-decoration:none;">072 862 6128</a></p>
  <p style="margin-top:1rem;font-size:.75rem;opacity:.5;">¬© 2025 C Pearl White. All rights reserved.</p>
</footer>

<a href="https://wa.me/94728626128" class="wa-float" target="_blank">üí¨</a>

<script>
// ============================================================
//  STORE DATA
// ============================================================
const ADMIN_PASSWORD = 'lady2025';

let categories = [
  { id:'lips',     name:'Lips' },
  { id:'face',     name:'Face' },
  { id:'eyes',     name:'Eyes' },
  { id:'nails',    name:'Nails' },
];

let products = [
  { id:0, name:'Matte Lipstick Set',  price:1200, emoji:'üíÑ', badge:'Hot',  inStock:true,  freeDelivery:false, catId:'lips', imgData:null, desc:'Long-lasting matte finish. 12 shades available. Vitamin E enriched.' },
  { id:1, name:'Glow Foundation',     price:2500, emoji:'‚ú®', badge:'',     inStock:true,  freeDelivery:false, catId:'face', imgData:null, desc:'Natural skin-matching formula. SPF 30. All skin types.' },
  { id:2, name:'Rose Blush Palette',  price:1800, emoji:'üå∏', badge:'New',  inStock:true,  freeDelivery:false, catId:'face', imgData:null, desc:'6-shade blush palette with mirror. Buildable coverage.' },
  { id:3, name:'Eyeshadow Palette',   price:2200, emoji:'üëÅÔ∏è', badge:'',     inStock:false, freeDelivery:false, catId:'eyes', imgData:null, desc:'18 shimmer & matte shades. Highly pigmented. Long wear.' },
  { id:4, name:'Nail Polish Set',     price:800,  emoji:'üíÖ', badge:'Sale', inStock:true,  freeDelivery:true,  catId:'nails',imgData:null, desc:'Quick dry formula. 20 trendy colors. Chip resistant.' },
  { id:5, name:'Highlighter Powder',  price:1500, emoji:'üåü', badge:'',     inStock:true,  freeDelivery:false, catId:'face', imgData:null, desc:'Blinding glow. 3 shades: champagne, rose gold, bronze.' },
];

let qtys = {};
let deliveryCharge = 350;
let freeDeliveryAbove = 0;
let logoDataUrl = null;
let logoMode = 'name';
let storeName1 = 'C Pearl';
let storeName2 = 'White';
let tagline = '‚ú¶ Premium Cosmetics ‚ú¶ Sri Lanka ‚ú¶';
let currentCat = 'all';
let nextProductId = 6;
let nextCatId = 10;

let salesPersons = [
  { id:'sp1', name:'Kasun',  phone:'0771234567', orders:0 },
  { id:'sp2', name:'Nimali', phone:'0772345678', orders:0 },
  { id:'sp3', name:'Ruwan',  phone:'0773456789', orders:0 },
  { id:'sp4', name:'Dilani', phone:'0774567890', orders:0 },
  { id:'sp5', name:'Chamath',phone:'0775678901', orders:0 },
];
let nextSpId = 6;
let activeSp = null; // currently active salesperson (detected from URL)

// Detect salesperson from URL ?sp=id
function detectSalesPerson(){
  const params = new URLSearchParams(window.location.search);
  const spId = params.get('sp');
  if (!spId) return;
  const sp = salesPersons.find(s => s.id === spId);
  if (!sp) return;
  activeSp = sp;
  document.getElementById('spBannerName').textContent = sp.name;
  document.getElementById('spBanner').classList.add('show');
  // Push down hero to account for extra banner
  document.querySelector('header').style.marginTop = '30px';
}

function getActiveWaNumber(){
  if (activeSp) {
    // Format phone: remove leading 0, add 94
    let num = activeSp.phone.replace(/\s/g,'');
    if (num.startsWith('0')) num = '94' + num.slice(1);
    return num;
  }
  return '94728626128'; // default store number
}

function getSiteUrl(){
  return window.location.origin + window.location.pathname;
}

// ============================================================
//  CATEGORY TABS (nav + section)
// ============================================================
function renderCatTabs() {
  // Nav center
  const navC = document.getElementById('navCenter');
  navC.innerHTML = `<a href="#products" class="nav-tab ${currentCat==='all'?'active':''}" onclick="showCategory('all',this)">All</a>`;
  categories.forEach(c => {
    const a = document.createElement('a');
    a.href = '#products';
    a.className = 'nav-tab' + (currentCat===c.id?' active':'');
    a.textContent = c.name;
    a.onclick = function(){ showCategory(c.id, this); };
    navC.appendChild(a);
  });
  navC.innerHTML += `<a href="#order" class="nav-tab">Order</a>`;

  // Section tabs
  const sec = document.getElementById('catTabsSection');
  sec.innerHTML = `<button class="cat-tab ${currentCat==='all'?'active':''}" onclick="showCategory('all',this)">All</button>`;
  categories.forEach(c => {
    const btn = document.createElement('button');
    btn.className = 'cat-tab' + (currentCat===c.id?' active':'');
    btn.textContent = c.name;
    btn.onclick = function(){ showCategory(c.id, this); };
    sec.appendChild(btn);
  });
}

function showCategory(catId, el) {
  currentCat = catId;
  // Update active tabs
  document.querySelectorAll('.nav-tab, .cat-tab').forEach(t => t.classList.remove('active'));
  if (el) el.classList.add('active');
  // Sync both tab bars
  document.querySelectorAll('.nav-tab').forEach(t => { if(t.textContent.trim() === (catId==='all'?'All': (categories.find(c=>c.id===catId)||{}).name)) t.classList.add('active'); });
  document.querySelectorAll('.cat-tab').forEach(t => { if(t.textContent.trim() === (catId==='all'?'All': (categories.find(c=>c.id===catId)||{}).name)) t.classList.add('active'); });
  filterProducts();
}

function filterProducts() {
  products.forEach(p => {
    const card = document.getElementById('card-' + p.id);
    if (!card) return;
    if (currentCat === 'all' || p.catId === currentCat) card.classList.remove('hidden-card');
    else card.classList.add('hidden-card');
  });
}

// ============================================================
//  RENDER PRODUCTS
// ============================================================
function renderProducts() {
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  products.forEach(p => {
    const q = qtys[p.id] || 0;
    const oos = !p.inStock;
    const cat = categories.find(c => c.id === p.catId);

    const card = document.createElement('div');
    card.className = 'card' + (q>0?' in-cart':'') + (oos?' out-of-stock':'') + (currentCat!=='all' && p.catId!==currentCat?' hidden-card':'');
    card.id = 'card-' + p.id;

    const imgContent = p.imgData
      ? `<img src="${p.imgData}" alt="${p.name}">`
      : `<span>${p.emoji}</span>`;

    // Bottom tag: free delivery takes priority over category label
    const bottomTag = p.freeDelivery
      ? `<div class="free-delivery-tag">üöö Free Delivery</div>`
      : (cat ? `<div class="cat-label-tag">${cat.name}</div>` : '');

    card.innerHTML = `
      <div class="card-img">
        ${imgContent}
        ${p.badge?`<span class="card-badge">${p.badge}</span>`:''}
        <span class="stock-badge ${p.inStock?'available':'out'}">${p.inStock?'‚úì Available':'Out of Stock'}</span>
        ${bottomTag}
      </div>
      <div class="card-body">
        <div class="card-name">${p.name}</div>
        <div class="card-desc">${p.desc||''}</div>
        <div class="card-footer">
          <div class="price">Rs. ${p.price.toLocaleString()} <small>/piece</small></div>
          <div class="qty-ctrl">
            <button class="qty-btn" onclick="changeQty(${p.id},-1)" ${q===0||oos?'disabled':''}>‚àí</button>
            <span class="qty-val" id="qty-${p.id}">${q}</span>
            <button class="qty-btn" onclick="changeQty(${p.id},1)" ${oos?'disabled':''}>+</button>
          </div>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}

// ============================================================
//  QTY & CART
// ============================================================
function changeQty(id, delta) {
  const p = products.find(x => x.id === id);
  if (!p || !p.inStock) return;
  qtys[id] = Math.max(0, (qtys[id]||0) + delta);
  const qEl = document.getElementById('qty-' + id);
  if (qEl) qEl.textContent = qtys[id];
  const card = document.getElementById('card-' + id);
  if (card) {
    card.classList.toggle('in-cart', qtys[id]>0);
    card.querySelectorAll('.qty-btn')[0].disabled = qtys[id]===0;
  }
  updateCart();
}

function calcDelivery(subtotal) {
  let allFree = true, anySelected = false;
  products.forEach(p => {
    if ((qtys[p.id]||0) > 0) { anySelected = true; if (!p.freeDelivery) allFree = false; }
  });
  if (!anySelected) return 0;
  if (allFree) return 0;
  if (freeDeliveryAbove > 0 && subtotal >= freeDeliveryAbove) return 0;
  return deliveryCharge;
}

function updateCart() {
  let subtotal = 0, count = 0;
  products.forEach(p => { const q=qtys[p.id]||0; subtotal+=q*p.price; count+=q; });
  const delivery = calcDelivery(subtotal);
  const total = subtotal + delivery;

  const bar = document.getElementById('cartBar');
  if (count > 0) {
    bar.classList.add('visible');
    document.getElementById('cartCount').textContent = count;
    document.getElementById('cartSubtotal').textContent = subtotal.toLocaleString();
  } else {
    bar.classList.remove('visible');
  }

  const summaryItems = document.getElementById('summaryItems');
  const noMsg = document.getElementById('noItemsMsg');
  const footer = document.getElementById('summaryFooter');
  summaryItems.innerHTML = '';

  if (count > 0) {
    noMsg.style.display = 'none';
    products.forEach(p => {
      const q = qtys[p.id]||0;
      if (q > 0) {
        const row = document.createElement('div');
        row.className = 'summary-row';
        row.innerHTML = `<span>${p.name} √ó ${q}</span><span>Rs. ${(q*p.price).toLocaleString()}</span>`;
        summaryItems.appendChild(row);
      }
    });
    let deliveryLabel = 'Delivery Charge';
    let deliveryText = delivery===0 ? 'FREE' : `Rs. ${delivery.toLocaleString()}`;
    if (delivery===0) {
      let allFree=true;
      products.forEach(p=>{ if((qtys[p.id]||0)>0&&!p.freeDelivery) allFree=false; });
      if (allFree) deliveryLabel='üöö Delivery (Free)';
      else if (freeDeliveryAbove>0&&subtotal>=freeDeliveryAbove) deliveryLabel=`üöö Free above Rs.${freeDeliveryAbove.toLocaleString()}`;
      else deliveryLabel='üöö Delivery (Free)';
    }
    document.getElementById('deliveryLabel').textContent = deliveryLabel;
    document.getElementById('deliveryValue').textContent = deliveryText;
    document.getElementById('formTotal').textContent = total.toLocaleString();
    footer.style.display = 'block';
  } else {
    noMsg.style.display = 'block';
    footer.style.display = 'none';
  }
}

// ============================================================
//  PHONE VALIDATION
// ============================================================
function validatePhone(val) {
  return /^[0-9]{10}$/.test(val.replace(/\s/g,''));
}

// ============================================================
//  ORDER FORM
// ============================================================
document.getElementById('orderForm').addEventListener('submit', function(e) {
  e.preventDefault();
  let valid = true;

  const p1 = document.getElementById('custPhone1').value.replace(/\s/g,'');
  const p2 = document.getElementById('custPhone2').value.replace(/\s/g,'');
  const e1 = document.getElementById('errPhone1');
  const e2 = document.getElementById('errPhone2');

  if (!validatePhone(p1)) {
    e1.style.display='block'; document.getElementById('custPhone1').classList.add('error'); valid=false;
  } else { e1.style.display='none'; document.getElementById('custPhone1').classList.remove('error'); }

  if (p2 !== '' && !validatePhone(p2)) {
    e2.style.display='block'; document.getElementById('custPhone2').classList.add('error'); valid=false;
  } else { e2.style.display='none'; document.getElementById('custPhone2').classList.remove('error'); }

  if (!valid) return;

  const name    = document.getElementById('custName').value;
  const address = document.getElementById('custAddress').value;
  const city    = document.getElementById('custCity').value;
  const note    = document.getElementById('custNote').value;

  let itemsList='', subtotal=0;
  products.forEach(p => {
    const q=qtys[p.id]||0;
    if(q>0){ itemsList+=`  ‚Ä¢ ${p.name} √ó ${q} = Rs. ${(q*p.price).toLocaleString()}\n`; subtotal+=q*p.price; }
  });

  if (!itemsList) { alert('Please select at least one product!'); return; }

  const delivery = calcDelivery(subtotal);
  const total = subtotal + delivery;
  const deliveryStr = delivery===0?'FREE':`Rs. ${delivery.toLocaleString()}`;

  const msg =
    `üå∏ *${storeName1} ${storeName2} - New Order* üå∏\n\n` +
    `üë§ *Name:* ${name}\n` +
    `üì± *Phone 1:* ${p1}\n` +
    (p2?`üì± *Phone 2:* ${p2}\n`:'') +
    `üìç *Address:* ${address}\n` +
    `üèôÔ∏è *Near City:* ${city}\n\n` +
    `üíÑ *Items:*\n${itemsList}\n` +
    `üöö *Delivery:* ${deliveryStr}\n` +
    `üí∞ *Total: Rs. ${total.toLocaleString()}*\n\n` +
    `üìù *Notes:* ${note||'None'}\n` +
    (activeSp?`üë§ *Sales Rep:* ${activeSp.name}\n`:'') +
    `\n_Please confirm. Thank you!_ üôè`;

  // Track order count for salesperson
  if (activeSp) {
    activeSp.orders = (activeSp.orders || 0) + 1;
    persistSave();
  }

  document.getElementById('successMsg').style.display='block';
  const waNum = getActiveWaNumber();
  setTimeout(()=>window.open(`https://wa.me/${waNum}?text=${encodeURIComponent(msg)}`,'_blank'),500);
});

// Phone input - only allow digits
['custPhone1','custPhone2'].forEach(id=>{
  document.getElementById(id).addEventListener('input',function(){
    this.value=this.value.replace(/[^0-9]/g,'').slice(0,10);
  });
});

// ============================================================
//  ADMIN - SECRET TRIGGER
// ============================================================
let secretTapCount=0, secretTapTimer=null;
function handleSecretTap(){
  secretTapCount++;
  clearTimeout(secretTapTimer);
  secretTapTimer=setTimeout(()=>{ secretTapCount=0; },2000);
  if(secretTapCount>=5){ secretTapCount=0; askAdminPassword(); }
}
document.addEventListener('DOMContentLoaded',()=>{
  const h=document.querySelector('header .hero-name')||document.querySelector('header');
  if(h) h.addEventListener('click',handleSecretTap);
  const hi=document.getElementById('heroLogoImg');
  if(hi) hi.addEventListener('click',handleSecretTap);
});
let keyBuffer='',keyTimer2=null;
document.addEventListener('keydown',e=>{
  if(document.activeElement.tagName==='INPUT'||document.activeElement.tagName==='TEXTAREA') return;
  if(e.key.toLowerCase()==='a'){
    keyBuffer+='a'; clearTimeout(keyTimer2);
    keyTimer2=setTimeout(()=>{ keyBuffer=''; },2000);
    if(keyBuffer.length>=5){ keyBuffer=''; askAdminPassword(); }
  } else { keyBuffer=''; }
});

function askAdminPassword(){
  document.getElementById('pwError').style.display='none';
  document.getElementById('adminPwInput').value='';
  document.getElementById('pwOverlay').classList.add('open');
  setTimeout(()=>document.getElementById('adminPwInput').focus(),200);
}
function checkAdminPw(){
  if(document.getElementById('adminPwInput').value===ADMIN_PASSWORD){
    document.getElementById('pwOverlay').classList.remove('open');
    // Populate admin fields with current saved values
    document.getElementById('aStoreName1').value=storeName1;
    document.getElementById('aStoreName2').value=storeName2;
    document.getElementById('aTagline').value=tagline;
    document.getElementById('aLogoMode').value=logoMode;
    document.getElementById('aDeliveryCharge').value=deliveryCharge;
    document.getElementById('aFreeDeliveryAbove').value=freeDeliveryAbove;
    if(logoDataUrl){ document.getElementById('logoPreviewBox').innerHTML=`<img src="${logoDataUrl}" style="width:100%;height:100%;object-fit:contain;">`; }
    buildSpAdmin();
    buildProductAdmin();
    buildCatAdmin();
    document.getElementById('adminOverlay').classList.add('open');
  } else {
    document.getElementById('pwError').style.display='block';
    document.getElementById('adminPwInput').value='';
    document.getElementById('adminPwInput').focus();
  }
}

// ============================================================
//  ADMIN - BUILD CATEGORY LIST
// ============================================================
function buildCatAdmin(){
  const list=document.getElementById('catAdminList');
  list.innerHTML='';
  categories.forEach((c,i)=>{
    const div=document.createElement('div');
    div.style='display:flex;gap:.6rem;margin-bottom:.6rem;align-items:center;';
    div.innerHTML=`
      <input type="text" id="catName-${c.id}" value="${c.name}" style="flex:1;padding:.5rem .7rem;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);color:#fff;font-family:\'DM Sans\',sans-serif;font-size:.9rem;outline:none;">
      <button class="del-product-btn" onclick="deleteCat('${c.id}')">‚úï Remove</button>`;
    list.appendChild(div);
  });
}

function addCategory(){
  const id='cat'+nextCatId++;
  categories.push({id,name:'New Category'});
  buildCatAdmin();
}
function deleteCat(id){
  categories=categories.filter(c=>c.id!==id);
  products.forEach(p=>{ if(p.catId===id) p.catId=''; });
  buildCatAdmin();
}

// ============================================================
//  ADMIN - BUILD SALESPERSON LIST
// ============================================================
function buildSpAdmin(){
  const list = document.getElementById('spAdminList');
  list.innerHTML = '';
  const baseUrl = getSiteUrl();
  salesPersons.forEach((sp, i) => {
    const link = `${baseUrl}?sp=${sp.id}`;
    const div = document.createElement('div');
    div.className = 'sp-card';
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem;">
        <div>
          <span style="color:var(--blush);font-size:.9rem;font-weight:500;" id="spLabel-${sp.id}">${sp.name}</span>
          <span class="sp-stats">üì¶ ${sp.orders} orders</span>
        </div>
        <button class="del-product-btn" onclick="deleteSp('${sp.id}')">‚úï</button>
      </div>
      <div class="admin-row" style="margin-top:.6rem;">
        <div class="admin-field"><label>Name</label><input type="text" id="spName-${sp.id}" value="${sp.name}"></div>
        <div class="admin-field"><label>WhatsApp No (07X)</label><input type="tel" id="spPhone-${sp.id}" value="${sp.phone}" maxlength="10"></div>
      </div>
      <label style="font-size:.7rem;color:var(--blush);display:block;margin-top:.4rem;letter-spacing:.05em;">SHARE LINK</label>
      <div class="sp-link-box" onclick="copySpLink('${link}', this)">
        ${link}
        <span class="copy-hint">üìã Copy</span>
      </div>`;
    list.appendChild(div);
  });
}

function copySpLink(link, el){
  navigator.clipboard.writeText(link).then(()=>{
    el.style.borderColor='#25D366';
    const hint = el.querySelector('.copy-hint');
    if(hint){ hint.textContent='‚úÖ Copied!'; setTimeout(()=>hint.textContent='üìã Copy',2000); }
  }).catch(()=>{
    // Fallback
    const ta=document.createElement('textarea');
    ta.value=link; document.body.appendChild(ta); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta);
    showToast('‚úÖ Link copied!');
  });
}

function addSalesPerson(){
  salesPersons.push({id:'sp'+nextSpId++, name:'New Person', phone:'07XXXXXXXX', orders:0});
  buildSpAdmin();
}
function deleteSp(id){
  salesPersons = salesPersons.filter(s=>s.id!==id);
  buildSpAdmin();
}

// ============================================================
//  ADMIN - BUILD PRODUCT LIST
// ============================================================
function buildProductAdmin(){
  const list=document.getElementById('productAdminList');
  list.innerHTML='';
  products.forEach((p,i)=>{
    const catOptions=categories.map(c=>`<option value="${c.id}" ${p.catId===c.id?'selected':''}>${c.name}</option>`).join('');
    const div=document.createElement('div');
    div.className='product-admin-card';
    div.innerHTML=`
      <div class="product-admin-card-title" style="display:flex;justify-content:space-between;">
        <span>Product ${i+1}: ${p.name}</span>
        <button class="del-product-btn" onclick="deleteProduct(${p.id})">‚úï Remove</button>
      </div>
      <div style="display:flex;gap:1rem;align-items:flex-start;flex-wrap:wrap;">
        <div class="img-preview-admin" id="imgPreview-${p.id}">${p.imgData?`<img src="${p.imgData}">`:'<span>'+p.emoji+'</span>'}</div>
        <div style="flex:1;min-width:180px;">
          <div class="admin-row">
            <div class="admin-field"><label>Name</label><input type="text" id="pName-${p.id}" value="${p.name}"></div>
            <div class="admin-field"><label>Price (Rs.)</label><input type="number" id="pPrice-${p.id}" value="${p.price}" min="0"></div>
          </div>
          <div class="admin-row">
            <div class="admin-field"><label>Category</label><select id="pCat-${p.id}">${catOptions}</select></div>
            <div class="admin-field"><label>Badge (Hot/New/Sale)</label><input type="text" id="pBadge-${p.id}" value="${p.badge||''}"></div>
          </div>
          <div class="admin-row">
            <div class="admin-field"><label>Description</label><input type="text" id="pDesc-${p.id}" value="${(p.desc||'').replace(/"/g,'&quot;')}"></div>
            <div class="admin-field"><label>Emoji (fallback)</label><input type="text" id="pEmoji-${p.id}" value="${p.emoji}"></div>
          </div>
          <div class="admin-row">
            <div class="admin-field">
              <label>Status</label>
              <select id="pStock-${p.id}">
                <option value="1" ${p.inStock?'selected':''}>‚úì Available</option>
                <option value="0" ${!p.inStock?'selected':''}>‚úó Out of Stock</option>
              </select>
            </div>
            <div class="admin-field">
              <label>Free Delivery for this Product</label>
              <select id="pFreeDelivery-${p.id}">
                <option value="0" ${!p.freeDelivery?'selected':''}>No ‚Äì Standard Charge</option>
                <option value="1" ${p.freeDelivery?'selected':''}>Yes ‚Äì Free Delivery</option>
              </select>
            </div>
          </div>
          <div class="admin-field" style="margin-top:.5rem;">
            <label>Product Image (Upload)</label>
            <input type="file" accept="image/*" onchange="previewProductImg(this,${p.id})">
          </div>
        </div>
      </div>`;
    list.appendChild(div);
  });
}

function addProduct(){
  products.push({id:nextProductId++,name:'New Product',price:0,emoji:'üå∏',badge:'',inStock:true,freeDelivery:false,catId:categories[0]?.id||'',imgData:null,desc:''});
  buildProductAdmin();
}
function deleteProduct(id){
  products=products.filter(p=>p.id!==id);
  delete qtys[id];
  buildProductAdmin();
}

function previewLogo(input){
  if(!input.files[0]) return;
  const r=new FileReader();
  r.onload=e=>{
    logoDataUrl=e.target.result;
    document.getElementById('logoPreviewBox').innerHTML=`<img src="${logoDataUrl}">`;
  };
  r.readAsDataURL(input.files[0]);
}
function previewProductImg(input,id){
  if(!input.files[0]) return;
  const r=new FileReader();
  r.onload=e=>{
    const p=products.find(x=>x.id===id);
    if(p) p.imgData=e.target.result;
    const box=document.getElementById('imgPreview-'+id);
    if(box) box.innerHTML=`<img src="${e.target.result}">`;
  };
  r.readAsDataURL(input.files[0]);
}

// ============================================================
//  ADMIN SAVE
// ============================================================
function saveAdmin(){
  // Branding
  storeName1=document.getElementById('aStoreName1').value||'C Pearl';
  storeName2=document.getElementById('aStoreName2').value||'White';
  tagline=document.getElementById('aTagline').value;
  logoMode=document.getElementById('aLogoMode').value;
  deliveryCharge=parseInt(document.getElementById('aDeliveryCharge').value)||0;
  freeDeliveryAbove=parseInt(document.getElementById('aFreeDeliveryAbove').value)||0;

  // Categories
  categories.forEach(c=>{
    const el=document.getElementById('catName-'+c.id);
    if(el) c.name=el.value;
  });

  // Products
  products.forEach(p=>{
    p.name    = document.getElementById('pName-'+p.id)?.value || p.name;
    p.price   = parseInt(document.getElementById('pPrice-'+p.id)?.value)||0;
    p.catId   = document.getElementById('pCat-'+p.id)?.value||'';
    p.badge   = document.getElementById('pBadge-'+p.id)?.value||'';
    p.desc    = document.getElementById('pDesc-'+p.id)?.value||'';
    p.emoji   = document.getElementById('pEmoji-'+p.id)?.value||'üå∏';
    p.inStock = document.getElementById('pStock-'+p.id)?.value==='1';
    p.freeDelivery = document.getElementById('pFreeDelivery-'+p.id)?.value==='1';
  });

  // ---- SAVE TO localStorage ----
  persistSave();

  // Save salesperson data
  salesPersons.forEach(sp=>{
    const n=document.getElementById('spName-'+sp.id);
    const p=document.getElementById('spPhone-'+sp.id);
    if(n) sp.name=n.value;
    if(p) sp.phone=p.value;
  });

  applyBranding();
  renderCatTabs();
  renderProducts();
  filterProducts();
  updateCart();
  document.getElementById('adminOverlay').classList.remove('open');
  showToast('‚úÖ Changes saved!');
}

// ============================================================
//  PERSIST ‚Äî save & load
// ============================================================
// ============================================================
//  CLOUD SYNC ‚Äî Cloudflare Workers + KV
//  ‚ö†Ô∏è  Setup ‡∂ö‡∑Ö‡∑è‡∂∏ ‡∂î‡∂∂‡∑ö Worker URL ‡∂∏‡∑ô‡∂≠‡∂± paste ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:
// ============================================================
const WORKER_URL = '';  // e.g. https://lady-paradise.yourname.workers.dev

function getStoreData() {
  return {
    storeName1, storeName2, tagline, logoMode, logoDataUrl,
    deliveryCharge, freeDeliveryAbove, categories, products,
    nextProductId, nextCatId, salesPersons, nextSpId
  };
}

function applyStoreData(d) {
  if (!d) return;
  if(d.storeName1!==undefined) storeName1=d.storeName1;
  if(d.storeName2!==undefined) storeName2=d.storeName2;
  if(d.tagline!==undefined) tagline=d.tagline;
  if(d.logoMode!==undefined) logoMode=d.logoMode;
  if(d.logoDataUrl!==undefined) logoDataUrl=d.logoDataUrl;
  if(d.deliveryCharge!==undefined) deliveryCharge=d.deliveryCharge;
  if(d.freeDeliveryAbove!==undefined) freeDeliveryAbove=d.freeDeliveryAbove;
  if(d.categories!==undefined) categories=d.categories;
  if(d.products!==undefined) products=d.products;
  if(d.nextProductId!==undefined) nextProductId=d.nextProductId;
  if(d.nextCatId!==undefined) nextCatId=d.nextCatId;
  if(d.salesPersons!==undefined) salesPersons=d.salesPersons;
  if(d.nextSpId!==undefined) nextSpId=d.nextSpId;
}

// ============================================================
//  FIREBASE PERSIST
// ============================================================
async function persistSave() {
  const data = getStoreData();
  // Always save locally as backup
  try { localStorage.setItem('ladyparadise_store', JSON.stringify(data)); } catch(e){}

  showToast('‚òÅÔ∏è Saving...');
  try {
    // Wait for Firebase if not ready yet
    if (!window._fbReady) {
      await new Promise(res => window.addEventListener('fbready', res, {once:true}));
    }
    // Firebase cannot store base64 images > 10MB, store separately
    const saveData = JSON.parse(JSON.stringify(data));
    // Extract product images to separate nodes to avoid size limits
    const images = {};
    saveData.products.forEach(p => {
      if (p.imgData) { images['p_'+p.id] = p.imgData; p.imgData = '__ref__'; }
    });
    if (saveData.logoDataUrl) { images['logo'] = saveData.logoDataUrl; saveData.logoDataUrl = '__ref__'; }

    await window._fbSet('ladyparadise/config', saveData);
    if (Object.keys(images).length > 0) {
      await window._fbSet('ladyparadise/images', images);
    }
    showToast('‚úÖ Saved! ‡∑É‡∑í‡∂∫‡∂Ω‡∑î devices update ‡∑Ä‡∑ô‡∂±‡∑Ä‡∑è!');
  } catch(e) {
    console.error('Firebase save error:', e);
    showToast('‚ö†Ô∏è Cloud save failed. Local save only.', true);
  }
}

async function persistLoad() {
  // Load local first for instant render
  try {
    const raw = localStorage.getItem('ladyparadise_store');
    if (raw) applyStoreData(JSON.parse(raw));
  } catch(e){}

  // Then load from Firebase (overrides local with latest)
  try {
    if (!window._fbReady) {
      await new Promise(res => window.addEventListener('fbready', res, {once:true}));
    }
    const data = await window._fbGet('ladyparadise/config');
    if (!data) return; // No cloud data yet

    // Restore images
    const images = await window._fbGet('ladyparadise/images');
    if (images) {
      data.products && data.products.forEach(p => {
        if (p.imgData === '__ref__' && images['p_'+p.id]) p.imgData = images['p_'+p.id];
      });
      if (data.logoDataUrl === '__ref__' && images['logo']) data.logoDataUrl = images['logo'];
    }

    applyStoreData(data);
    try { localStorage.setItem('ladyparadise_store', JSON.stringify(data)); } catch(e){}

    // Re-render with fresh cloud data
    applyBranding();
    renderCatTabs();
    renderProducts();
    detectSalesPerson();
  } catch(e) {
    console.warn('Firebase load failed, using local data:', e);
  }
}

// ============================================================
//  TOAST
// ============================================================
function showToast(msg,isError=false){
  let t=document.getElementById('storeToast');
  if(!t){
    t=document.createElement('div');
    t.id='storeToast';
    t.style='position:fixed;bottom:5rem;left:50%;transform:translateX(-50%);padding:.8rem 1.6rem;border-radius:4px;font-size:.9rem;z-index:99999;transition:opacity .5s;white-space:nowrap;';
    document.body.appendChild(t);
  }
  t.textContent=msg;
  t.style.background=isError?'#6b2a2a':'#1a3a2a';
  t.style.color=isError?'#ff9999':'#25D366';
  t.style.border='1px solid '+(isError?'#ff6b6b':'#25D366');
  t.style.opacity='1';
  clearTimeout(t._timer);
  t._timer=setTimeout(()=>t.style.opacity='0',2500);
}

// ============================================================
//  BRANDING APPLY
// ============================================================
function applyBranding(){
  document.getElementById('heroName').innerHTML=`${storeName1}<br><span>${storeName2}</span>`;
  document.getElementById('heroTagline').textContent=tagline;
  document.getElementById('navLogoText').innerHTML=`${storeName1} <span>${storeName2}</span>`;
  document.getElementById('footBrand').innerHTML=`${storeName1} <span>${storeName2}</span>`;
  document.title=`${storeName1} ${storeName2} | Cosmetics`;

  const navImg=document.getElementById('navLogoImg');
  const heroImg=document.getElementById('heroLogoImg');
  const navTxt=document.getElementById('navLogoText');
  const heroName=document.getElementById('heroName');

  if(logoDataUrl){ navImg.src=logoDataUrl; heroImg.src=logoDataUrl; }

  if(logoMode==='logo'&&logoDataUrl){
    navImg.style.display='block'; navTxt.style.display='none';
    heroImg.style.display='block'; heroName.style.display='none';
  } else if(logoMode==='both'&&logoDataUrl){
    navImg.style.display='block'; navTxt.style.display='block';
    heroImg.style.display='block'; heroName.style.display='block';
  } else {
    navImg.style.display='none'; navTxt.style.display='block';
    heroImg.style.display='none'; heroName.style.display='block';
  }
}

// ============================================================
//  SMOOTH SCROLL
// ============================================================
document.addEventListener('click',e=>{
  const a=e.target.closest('a[href^="#"]');
  if(!a) return;
  const t=document.querySelector(a.getAttribute('href'));
  if(t){ e.preventDefault(); t.scrollIntoView({behavior:'smooth'}); }
});

// ============================================================
//  INIT ‚Äî load cloud data then render
// ============================================================
(async function(){
  // Show loading indicator
  document.getElementById('productGrid').innerHTML =
    '<div style="grid-column:1/-1;text-align:center;padding:3rem;color:var(--muted);">‚è≥ Loading products...</div>';

  await persistLoad();   // waits for cloud data
  applyBranding();
  renderCatTabs();
  renderProducts();
  detectSalesPerson();
})();
</script>
</body>
</html>
